# Ray Cluster Configuration für Mac Studio Cluster

# Head Node (Master) - Management VLAN
head_node:
  host: "10.30.30.10"  # Management VLAN IP
  gcs_port: 6380  # GCS Server Port
  client_server_port: 10001  # Ray Client Server Port
  dashboard_port: 8265
  vlan: "management"
  vlan_id: 30

# Worker Nodes - Worker VLAN
worker_nodes:
  - host: "10.10.10.11"  # Mac Studio M3 - Worker VLAN
    gcs_port: 6380  # GCS Server Port (vom Head Node)
    management_ip: "10.30.30.11"  # Management VLAN für SSH/Monitoring
    vlan: "worker"
    vlan_id: 10
    resources:
      CPU: 16
      GPU: 1  # MLX GPU
      memory: 128000  # MB
  - host: "10.10.10.12"  # Mac Studio M4 - Worker VLAN
    gcs_port: 6380  # GCS Server Port (vom Head Node)
    management_ip: "10.30.30.12"  # Management VLAN für SSH/Monitoring
    vlan: "worker"
    vlan_id: 10
    resources:
      CPU: 16
      GPU: 1  # MLX GPU
      memory: 128000  # MB

# Storage Node - Storage VLAN
storage_node:
  host: "10.20.20.100"  # Storage VLAN IP
  management_ip: "10.30.30.100"  # Management VLAN für SSH/Monitoring
  vlan: "storage"
  vlan_id: 20
  services:
    minio: 9000
    minio_console: 9001

# Ray Configuration
ray:
  num_cpus: 16
  num_gpus: 1  # MLX GPU pro Node
  # object_store_memory wird automatisch von Ray gewählt
  dashboard_host: "0.0.0.0"
  gcs_port: 6380  # GCS Server Port
  client_server_port: 10001  # Ray Client Server Port
  runtime_env:
    pip:
      - mlx>=0.29.0
      - mlx-lm>=0.28.0
      - numpy>=1.24.0
      - pillow>=9.0.0
      - requests>=2.28.0

# Resource Allocation
resources:
  face_detection:
    num_cpus: 2
    num_gpus: 0.5  # Teilweise GPU für Face Detection
  embedding:
    num_cpus: 2
    num_gpus: 0.5  # Teilweise GPU für Embeddings
  clustering:
    num_cpus: 4
    num_gpus: 0  # CPU-only

# Network Configuration
network:
  redis_password: null  # Optional: Redis Password für Sicherheit
  node_ip_address: "0.0.0.0"
  allow_ports: [10001, 8265, 10002]  # Ray Ports
  
# VLAN Configuration
vlans:
  management:
    subnet: "10.30.30.0/24"
    gateway: "10.30.30.1"
    services:
      - ray_dashboard: 8265
      - ssh: 22
      - monitoring: 9090
      
  worker:
    subnet: "10.10.10.0/24"
    gateway: "10.10.10.1"
    services:
      - ray_worker: 10001
      - face_detection: 5001
      - embedding: 5002
      
  storage:
    subnet: "10.20.20.0/24"
    gateway: "10.20.20.1"
    services:
      - minio: 9000
      - minio_console: 9001


